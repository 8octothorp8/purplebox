<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Link Finder (TMDB Movie Filter)</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  input { width: 300px; padding: 5px; }
  button { padding: 6px 10px; }
  ul { margin-top: 20px; }
</style>
</head>
<body>

<h2>Link Finder</h2>

<input id="url" placeholder="Enter a URL or search term">
<button onclick="findLinks()">Search</button>

<ul id="results"></ul>

<script>
async function findLinks() {
  let input = document.getElementById("url").value.trim();
  const results = document.getElementById("results");
  results.innerHTML = "";

  // Convert text to TMDB search URL
  if (!input.startsWith("http://") && !input.startsWith("https://")) {
    const query = input.split(" ").join("+");
    input = `https://www.themoviedb.org/search?language=en-US&query=${query}`;
    document.getElementById("url").value = input;
  }

  try {
    const proxyURL = "https://api.allorigins.win/get?url=" + encodeURIComponent(input);
    const res = await fetch(proxyURL);
    const data = await res.json();

    const parser = new DOMParser();
    const doc = parser.parseFromString(data.contents, "text/html");

    const links = [...doc.querySelectorAll("a")].map(a => a.href);

    // Filter: must include /movie/ and have 2+ digits in a row
    const movieLink = links.find(href =>
      href.includes("/movie/") && /\d{2,}/.test(href)
    );

    if (!movieLink) {
      results.innerHTML = "<li>No movie link found.</li>";
      return;
    }

    const li = document.createElement("li");
    li.textContent = movieLink;
    results.appendChild(li);

  } catch (err) {
    results.innerHTML = "<li>Error fetching page.</li>";
  }
}
</script>

</body>
</html>
